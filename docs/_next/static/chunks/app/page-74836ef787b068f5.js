(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{495:function(){},7147:function(){},1418:function(){},8741:function(){},8386:function(){},3342:function(){},8681:function(e,s,t){Promise.resolve().then(t.bind(t,1103))},1103:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return O}});var a=t(7437),l=t(2265),n=t(6463),i=t(8472);let r=async e=>{let s=new URLSearchParams({...e,format:"json",origin:"*"}).toString();return await i.Z.get("https://congruence-engine.wikibase.cloud/w/api.php?"+s,{headers:{Accept:"application/json"}}).then(e=>e.data).catch(e=>e)},o=async e=>{let s={...e,action:"query"},t=await r(s),a=[];return(t.hasOwnProperty("query")&&(a=t.query[e.list].map(e=>0===e.ns?e.title:e.title.split(":")[1])),t.hasOwnProperty("continue"))?(e.continue=t.continue.continue,"allpages"===e.list?e.apcontinue=t.continue.apcontinue:"search"===e.list&&(e.sroffset=t.continue.sroffset),a.concat(await o(e))):a},d=async e=>{let s=e.ids.join("|"),t={...e,ids:s,action:"wbgetentities",props:"labels|descriptions|claims"},a=[];if(t.ids.length){let e=await r(t);e.hasOwnProperty("entities")&&(a=Object.entries(e.entities).map(e=>{let[s,t]=e;return t}))}return a},c=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.map(e=>{let t={id:e.id,type:e.type,label:Object.keys(e.labels).length>0?u(e.labels):null,description:Object.keys(e.descriptions).length>0?u(e.descriptions):null};return Object.keys(e.claims).length>0&&(t.statements=h(e.claims,s)),t})},u=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en";return e.hasOwnProperty(s)?e[s].value:Object.keys(e).length>0?e[Object.keys(e)[0]].value:null},h=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={};return Object.entries(e).forEach(e=>{let[a,l]=e,n=s.hasOwnProperty(a)?s[a]:a,i=[];for(let e of l){var r,o,d,c,u,v,m;let t={id:a,value:null!==(v=null!==(u=null===(o=e.mainsnak)||void 0===o?void 0:null===(r=o.datavalue)||void 0===r?void 0:r.value)&&void 0!==u?u:null===(d=e.datavalue)||void 0===d?void 0:d.value)&&void 0!==v?v:null,datatype:null!==(m=null===(c=e.mainsnak)||void 0===c?void 0:c.datatype)&&void 0!==m?m:e.datatype};e.hasOwnProperty("qualifiers")&&(t.qualifiers=h(e.qualifiers,s)),i.push(t)}t={...t,[n]:i}}),t},v=async e=>{let s={...e,list:"search"};return await o(s)},m=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=await v(e);return c(await d({ids:t}),s)},p=function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"s";return"".concat(e," ").concat(s).concat(1!==e?t:"")};var g=e=>{let[s,t]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{t(e.isbusy)},[e]),(0,a.jsx)("div",{id:"search-results",children:s?(0,a.jsx)(()=>(0,a.jsx)("div",{className:"loader",children:(0,a.jsx)("div",{className:"dots"})}),{}):(0,a.jsx)(()=>{var s;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{role:"status",children:(null===(s=e.keywords)||void 0===s?void 0:s.length)?"".concat(p(e.data.length,"record")," found."):"Showing ".concat(e.data.length," records.")}),e.data.length?(0,a.jsx)("ol",{className:"tile",children:e.data.map(e=>{var s,t,l,n,i,r,o;return(0,a.jsxs)("li",{className:"item",children:[(0,a.jsxs)("div",{className:"entry",children:[(0,a.jsx)("h2",{className:"label",children:e.label}),(0,a.jsx)("p",{className:"description",children:e.description})]}),(0,a.jsxs)("ul",{className:"statements",children:[(0,a.jsxs)("li",{className:"property",children:[(0,a.jsx)("p",{className:"name",children:"Keywords"}),(0,a.jsx)("p",{className:"value",children:(null===(s=e.statements)||void 0===s?void 0:s.keywords)?e.statements.keywords.map(e=>e.value).join(", "):"N/A"})]}),(0,a.jsxs)("li",{className:"property",children:[(0,a.jsx)("p",{className:"name",children:"Held By"}),(0,a.jsx)("p",{className:"value",children:(null===(t=e.statements)||void 0===t?void 0:t.heldby)?null===(l=e.statements)||void 0===l?void 0:l.heldby.map((e,s)=>{var t,l,n;return(0,a.jsxs)("span",{children:[s?"; ":"",(null===(t=e.qualifiers)||void 0===t?void 0:t.describedURL)&&(null===(n=e.qualifiers)||void 0===n?void 0:null===(l=n.describedURL[0])||void 0===l?void 0:l.value)?(0,a.jsx)("a",{href:e.qualifiers.describedURL[0].value,children:e.value}):e.value]},s)}):"N/A"})]}),(0,a.jsxs)("li",{className:"property",children:[(0,a.jsx)("p",{className:"name",children:"Datasheet"}),(0,a.jsx)("p",{className:"value",children:(null===(n=e.statements)||void 0===n?void 0:n.datasheet)&&(null===(i=e.statements.datasheet[0])||void 0===i?void 0:i.value)?(0,a.jsx)("a",{href:e.statements.datasheet[0].value,children:"Digital Cultural Heritage Datasheet"}):"N/A"})]}),(0,a.jsxs)("li",{className:"property",children:[(0,a.jsx)("p",{className:"name",children:"Used By"}),(0,a.jsx)("p",{className:"value",children:(null===(r=e.statements)||void 0===r?void 0:r.usedby)?null===(o=e.statements)||void 0===o?void 0:o.usedby.map((e,s)=>{var t,l,n;return(0,a.jsxs)("span",{children:[s?"; ":"",(null===(t=e.qualifiers)||void 0===t?void 0:t.describedURL)&&(null===(n=e.qualifiers)||void 0===n?void 0:null===(l=n.describedURL[0])||void 0===l?void 0:l.value)?(0,a.jsx)("a",{href:e.qualifiers.describedURL[0].value,children:e.value}):e.value]},s)}):"N/A"})]}),(0,a.jsxs)("li",{className:"property",children:[(0,a.jsx)("p",{className:"name",children:"Data Register"}),(0,a.jsx)("p",{className:"value",children:(0,a.jsxs)("a",{href:"https://congruence-engine.wikibase.cloud/wiki/"+e.id,children:["Congruence Engine Data Register (",e.id,")"]})})]})]})]},e.id)})}):null]})},{})})};let y=e=>{let s=JSON.parse(sessionStorage.getItem("cewbdata"));return e.map(e=>s.find(s=>s.id===e))};var f=e=>{let[s,t]=(0,l.useState)([]),[n,i]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{var s;i(!0);let a=async e=>{let s={srsearch:"haswbstatement:P1=Q1",srnamespace:120},a={};if(e.trim().length){e=e.trim();let t=new RegExp(/"|'|~|\*|\\\?|-|!|AND|OR|MUST|SHOULD/).test(e),a=new RegExp(/haswbstatement|inlabel|incaption|wbstatementquantity|hasdescription|haslabel|hascaption/).test(e),l=e.split(" ").some(e=>s.srsearch.split(" ").includes(e));t||a||(e=e.split(" ").join("* OR ")+"*"),a||l||(e=s.srsearch+" "+e)}Object.assign(a,{srsearch:e}),a={...s,...a},t(y(await v(a))),i(!1)};(null===(s=e.keywords)||void 0===s?void 0:s.length)?a(e.keywords):(t(JSON.parse(sessionStorage.getItem("cewbdata"))),i(!1))},[e]),(0,a.jsx)(g,{keywords:e.keywords,data:s,isbusy:n})},j=t(9078);j.OBj.allowLocalModels=!1,j.OBj.allowRemoteModels=!0;let w=async e=>{let s=await (0,j.EUT)("feature-extraction","Xenova/bge-base-en-v1.5");return await Promise.all(e.map(async e=>(await s(e,{pooling:"mean",normalize:!0})).tolist()[0]))},b=e=>{let s=JSON.parse(sessionStorage.getItem("cewbdata"));return e.map(e=>s.find(s=>s.id===e))};var x=e=>{let[s,t]=(0,l.useState)([]),[n,i]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{var s;i(!0);let a=async()=>await w(function(e){let s=[];return e.forEach(e=>{var t;let a=e.label?e.label.trim():"";e.description&&(a=a+" "+e.description.trim()),(null===(t=e.statements)||void 0===t?void 0:t.keywords)&&(a=a+" "+e.statements.keywords.map(e=>e.value).join(", ")),s.push(a)}),s}(l)),l=JSON.parse(sessionStorage.getItem("cewbdata"));l.filter(e=>e.hasOwnProperty("embeddings")).length>0||a().then(e=>{l.map((s,t)=>{s.embeddings=e[t]}),sessionStorage.setItem("cewbdata",JSON.stringify(l))});let n=async e=>{w([e]).then(e=>{console.log(e[0]);let s=JSON.parse(sessionStorage.getItem("cewbdata")),a=[];s.forEach(s=>{a.push({id:s.id,cosine:function(e,s){let t=0,a=0,l=0;for(let n=0;n<e.length;n++)t+=e[n]*s[n],a+=e[n]*e[n],l+=s[n]*s[n];return t/((a=Math.sqrt(a))*(l=Math.sqrt(l)))}(s.embeddings,e[0])})}),a.sort((e,s)=>e.cosine<s.cosine?1:-1);let l=[];a.forEach(e=>{l.push(e.id)}),console.log(a),console.log(l),t(b(l))}),i(!1)};(null===(s=e.keywords)||void 0===s?void 0:s.length)?n(e.keywords):(t(l),i(!1))},[e]),(0,a.jsx)(g,{keywords:e.keywords,data:s,isbusy:n})};let N={P1:"instanceOf",P2:"describedURL",P3:"keywords",P4:"created",P5:"heldby",P6:"availableURL",P7:"copyrightStatus",P8:"copyrightLicense",P9:"datasheet",P10:"usedby"},S=async()=>await m({srsearch:"haswbstatement:P1=Q1",srnamespace:120},N);var k=()=>{var e,s,t,i,r,o;let d=(0,n.useSearchParams)(),[c,u]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{(async()=>{null===sessionStorage.getItem("cewbdata")&&await S().then(e=>{e.sort((e,s)=>{let t=RegExp(/^The /,"gm"),a=null!==e.label?e.label.replace(t,""):e.label,l=null!==s.label?s.label.replace(t,""):s.label;return null===a||null===l?0:+(a>l)||-(a<l)}),sessionStorage.setItem("cewbdata",JSON.stringify(e))}),u(!0)})()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("form",{id:"search",children:[(0,a.jsxs)("div",{className:"fieldgroup",children:[(0,a.jsx)("label",{htmlFor:"searchmode",children:"Search Mode"}),(0,a.jsxs)("select",{name:"searchmode",id:"searchmode",defaultValue:null!==(o=null===(e=d.get("searchmode"))||void 0===e?void 0:e.toString())&&void 0!==o?o:"fulltext",children:[(0,a.jsx)("option",{value:"fulltext",children:"Full Text Search"}),(0,a.jsx)("option",{value:"vector",children:"Vector Search"})]})]}),(0,a.jsxs)("div",{className:"fieldgroup",children:[(0,a.jsx)("label",{htmlFor:"keywords",children:"Keywords"}),(0,a.jsx)("input",{type:"search",name:"keywords",id:"keywords",placeholder:"Search...",defaultValue:null===(s=d.get("keywords"))||void 0===s?void 0:s.toString()})]}),(0,a.jsx)("button",{type:"submit",children:(0,a.jsx)("span",{className:"label",children:" Search"})})]}),c?(null===(t=d.get("searchmode"))||void 0===t?void 0:t.toString())==="vector"?(0,a.jsx)(x,{keywords:null===(i=d.get("keywords"))||void 0===i?void 0:i.toString()}):(0,a.jsx)(f,{keywords:null===(r=d.get("keywords"))||void 0===r?void 0:r.toString()}):null]})},O=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:"home",children:"Search"}),(0,a.jsx)(l.Suspense,{children:(0,a.jsx)(k,{})})]})}},function(e){e.O(0,[165,132,193,593,971,23,744],function(){return e(e.s=8681)}),_N_E=e.O()}]);